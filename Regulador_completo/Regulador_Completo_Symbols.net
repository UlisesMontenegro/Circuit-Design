* C:\Users\joaqu\Desktop\Circuit-Design\Regulador_completo\Regulador_Completo_Symbols.asc
XBuck 0 VIN VOP VREF NC_01 Vreg buck_v
VIN VIN 0 12 Rser=0.1
RL Vo 0 {RL}
R3 Vo N005 1
CL N005 0 {CL}
V1 N001 0 0
R1 DISABLE N001 10
C1 DISABLE 0 400µ
XSupport 0 VIN VOP VPOSA VREF support
XLDOA VOP VPOSA VREF Vreg N002 ldoa_v2
S1 0 Vo N004 0 SW
V2 N004 0
R4 Vo N002 0.1

* block symbol definitions
.subckt buck_v GND VIN VOP VREF ctrl VREG
L1 Vsw VREG 90µ
C1 N001 GND 10µ
C2 N002 GND 1n
R1 VREG N001 100m
R2 VREG N002 0.1
Rf1 VREG Vf_buck 46.2k
Rf2 Vf_buck GND 10.7k
B1 N003 GND V=limit(v(ctrl), 0.01, 0.9)
Vz1 ctrl y AC 1 Rser=0.1
XU1 N006 Vf_buck VOP 0 y LM358
C3 Vf_buck y 160p
C4 N004 y 3n
R3 Vf_buck N004 10k
C5 N005 Vf_buck 628p
R4 VREG N005 1.6k
R5 N006 VREF 10
C6 N006 GND 4.7µ
XU2 VIN Vsw Vsw 0 N003 CCM2 Ron=0.16 VD=0 RD=0.16
.include LM358.txt
.lib switching_average\average.lib
.ends buck_v

.subckt support GND VIN VOP VPOSA VREF
R5 N001 VIN 5.6K
XU3 N001 0 LT1004-1.2
R6 VREF N001 25
R7 VREF GND 1K
XU1 0 VOP N002 TL431
R2 VOP N002 3.8k
R3 N002 0 1k
R4 VOP VIN 330
XU2 0 VPOSA N003 TL431
R1 VPOSA N003 1k
R8 N003 0 1k
R9 VPOSA VIN 330
.include tl431.lib
.ends support

.subckt ldoa_v2 VOP VPOSA VREF VREG VA
Q1 N001 N001 P001 0 BC327-25
Q2 Vp N001 P002 0 BC327-25
Q3 N001 N003 Pol 0 BC546B
Q4 Vp Vf Pol 0 BC546B
Q§TIP1 Vs1 N002 VREG 0 TIP42C
Q5 N002 Vp Vs1 0 Q2N6487
Rf1 VA Vf 3.16k
Rf2 N004 0 840
R1 VREG P001 470
R2 VREG P002 470
Rs1 VA Vs1 0.1
R3 Vs N012 10k
R4 Vrefc N016 10k
R5 N016 N015 100k
R6 N012 0 100k
Q6 Vp N014 0 0 2N2222
R7 N007 Vs 100k
R8 VA N007 10k
R9 Vs1 N006 10k
R10 N006 0 100k
R11 N008 VREF 82k
R12 0 N008 10k
R13 Vf N019 51k
R14 N019 0 47k
R15 N010 N009 10k
R16 N010 N020 10k
R17 Vrefc N011 10k
R18 0 N011 10k
Rf3 Vf N004 1K
R19 N015 N014 100
Q7 N013 N013 N017 0 BC546B
R20 VPOSA N013 3.8K
Q8 Pol N013 N018 0 BC546B
C1 Vp 0 100n
XU1 N010 N011 VOP 0 Vrefc LM324
XU2 N008 N009 VOP 0 N009 LM324
XU3 N019 N020 VOP 0 N020 LM324
XU4 N012 N016 VOP 0 N015 LM324
XU5 N006 N007 VOP 0 Vs LM324
R21 N017 0 470
R22 N018 0 470
R23 N003 VREF 10
C2 N003 0 4.7µ
M1 N004 N005 0 0 2N7002
R24 VPOSA N005 220
R25 N005 0 100k
C5 N007 Vs 1n
C6 N016 N015 10n
.include 2N6487.lib
.include LM324.txt
.MODEL TIP42C PNP(Is=66.19f Xti=3 Eg=1.11 Vaf=100 Bf=137.6 Ise=862.2f Ne=1.481 Ikf=1.642 Nk=.5695 Xtb=2 Br=5.88 Isc=273.5f Nc=1.24 Ikr=3.555 Rc=79.39m Cjc=870.4p Mjc=.6481 Vjc=.75 Fc=.5 Cje=390.1p Mje=.4343 Vje=.75 Tr=235.4n Tf=23.21n Itf=71.33 Xtf=5.982 Vtf=10 Rb=.1 Vceo=100 Icrating=6 mfg=Texas)
.ends ldoa_v2

.model NPN NPN
.model PNP PNP
.lib C:\Users\joaqu\Documents\LTspiceXVII\lib\cmp\standard.bjt
.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\joaqu\Documents\LTspiceXVII\lib\cmp\standard.mos
.tran 200m startup
.include LM339.txt
.param RL 250
.param CL 7u
* Includes
* Parametros
* Simulaciones
.meas DC Vo1rl FIND V(Vo) AT=12
.meas DC Vo2rl FIND V(Vo) AT=36
.meas DC RegLin PARAM ((Vo2rl-Vo1rl)/0.2)
* Regulacion de linea
.meas OP Vo1rc FIND V(Vo) AT 500
.meas OP Vo2rc FIND V(Vo) AT 10
.meas OP Io1rc FIND I(RL) AT 500
.meas OP Io2rc FIND I(RL) AT 10
.meas OP RegCar PARAM (-(Vo2rc-Vo1rc)/(Io2rc-Io1rc))
* Regulacion de carga
* -100*((V(vo)*I(RL))/(V(VIN)*I(VIN)))
* Eficiencia
;dc VIN 12 36
;step param RL 1 100 0.5
.op
.model SW SW (Ron = 0.1 Roff = 100Meg Vt=0.5 Vh=0.25 )
.lib LTC3.lib
.backanno
.end
