* D:\Uli\FIUBA\Materias\Diseño de Circuitos\TP\Circuit-Design\Regulador_completo\Regulador_Completo_Symbols.asc
XBuck 0 VIN VOP VREF NC_01 N002 buck_v
XSupport 0 VIN VOP VPOSA VREF support
VIN VIN 0 12
RL Vo 0 {RL}
R3 Vo N003 1
CL N003 0 {CL}
XX1 DISABLE 0 VOP VPOSA VREF N002 Vo ldoa
V1 N001 0 0
R1 DISABLE N001 10
C1 DISABLE 0 400µ

* block symbol definitions
.subckt buck_v GND VIN VOP VREF ctrl VREG
L1 Vsw VREG 90µ
C1 N001 GND 10µ
C2 N002 GND 1n
R1 VREG N001 100m
R2 VREG N002 0.1
Rf1 VREG Vf_buck 46.2k
Rf2 Vf_buck GND 10.7k
B1 N003 GND V=limit(v(ctrl), 0.01, 0.9)
Vz1 ctrl y AC 1 Rser=0.1
XU1 N006 Vf_buck VOP 0 y LM358
C3 Vf_buck y 160p
C4 N004 y 3n
R3 Vf_buck N004 10k
C5 N005 Vf_buck 628p
R4 VREG N005 1.6k
R5 N006 VREF 10
C6 N006 GND 4.7µ
XU2 VIN Vsw Vsw 0 N003 CCM2 Ron=0.16 VD=0 RD=0.16
.include LM358.txt
.lib switching_average\average.lib
.ends buck_v

.subckt support GND VIN VOP VPOSA VREF
R1 VPOSA VIN 11K
XU2 VPOSA 0 LT1389-5
R5 N001 VIN 5.6K
XU3 N001 0 LT1004-1.2
R6 VREF N001 25
R7 VREF GND 1K
R8 N002 VIN 11K
XU4 N002 0 LT1389-5
V1 VOP 0 5V
.ends support

.subckt ldoa DISABLE GND VOP VPOSA VREF VREG Vo
Q1 N001 N001 P001 0 BC327-25
Q2 Vp N001 P002 0 BC327-25
Q3 N001 N003 Pol 0 BC546B
Q4 Vp Vf Pol 0 BC546B
Q§TIP1 Vs1 N002 VREG 0 TIP42C
Q5 N002 Vp Vs1 0 Q2N6487
Rf1 Vo Vf 3.16k
Rf2 N004 GND 840
R1 VREG P001 470
R2 VREG P002 470
Rs1 Vo Vs1 0.1
R3 Vs N011 1k
R4 Vrefc N015 1k
R5 N015 N014 100k
R6 N011 GND 100k
Q6 Vp N013 GND 0 2N2222
R7 N006 Vs 100k
R8 Vo N006 10k
R9 Vs1 N005 10k
R10 N005 GND 100k
R11 N007 VREF 50k
R12 GND N007 10k
R13 Vf N018 54.4k
R14 N018 GND 46k
R15 N009 N008 10k
R16 N009 N019 10k
R17 Vrefc N010 10k
R18 GND N010 10k
Rf3 Vf N004 1K
R19 N014 N013 100
Q7 N012 N012 N016 0 BC546B
R20 VPOSA N012 3.8K
Q8 Pol N012 N017 0 BC546B
C2 Vp GND 100n
XU1 N009 N010 VOP 0 Vrefc LM358
XU2 N007 N008 VOP 0 N008 LM358
XU3 N018 N019 VOP 0 N019 LM358
XU4 N011 N015 VOP 0 N014 LM358
XU5 N005 N006 VOP 0 Vs LM358
R22 N016 GND 470
R23 N017 GND 470
C3 N015 N014 100n
C4 N006 Vs 100n
R24 N003 VREF 10
C5 N003 GND 4.7µ
M1 N004 VOP GND GND 2N7002
Q9 Vp DISABLE GND 0 2N2222
.include LM358.txt
.MODEL TIP42C PNP(Is=66.19f Xti=3 Eg=1.11 Vaf=100 Bf=137.6 Ise=862.2f Ne=1.481 Ikf=1.642 Nk=.5695 Xtb=2 Br=5.88 Isc=273.5f Nc=1.24 Ikr=3.555 Rc=79.39m Cjc=870.4p Mjc=.6481 Vjc=.75 Fc=.5 Cje=390.1p Mje=.4343 Vje=.75 Tr=235.4n Tf=23.21n Itf=71.33 Xtf=5.982 Vtf=10 Rb=.1 Vceo=100 Icrating=6 mfg=Texas)
.include 2N6487.lib
.ends ldoa

.model NPN NPN
.model PNP PNP
.lib C:\Users\Windows\Documents\LTspiceXVII\lib\cmp\standard.bjt
.model NMOS NMOS
.model PMOS PMOS
.lib C:\Users\Windows\Documents\LTspiceXVII\lib\cmp\standard.mos
.tran 500m startup
.include LM339.txt
.param RL 5
.param CL 15u
* Includes
* Parametros
* Simulaciones
.meas DC Vo1rl FIND V(Vo) AT=12
.meas DC Vo2rl FIND V(Vo) AT=36
.meas DC RegLin PARAM ((Vo2rl-Vo1rl)/0.2)
* Regulacion de linea
.meas OP Vo1rc FIND V(Vo) AT 500
.meas OP Vo2rc FIND V(Vo) AT 10
.meas OP Io1rc FIND I(RL) AT 500
.meas OP Io2rc FIND I(RL) AT 10
.meas OP RegCar PARAM (-(Vo2rc-Vo1rc)/(Io2rc-Io1rc))
* Regulacion de carga
* -100*((V(vo)*I(RL))/(V(VIN)*I(VIN)))
* Eficiencia
;dc VIN 12 36
;step param RL 100 0.1 0.25
;op
.lib LT1389.lib
.lib LTC3.lib
.backanno
.end
