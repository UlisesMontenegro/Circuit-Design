Version 4
SHEET 1 10072 1956
WIRE -32 -768 -400 -768
WIRE 128 -768 -32 -768
WIRE 384 -768 208 -768
WIRE 528 -768 384 -768
WIRE 864 -768 528 -768
WIRE 1040 -768 864 -768
WIRE 2160 -768 1888 -768
WIRE 2384 -768 2160 -768
WIRE 2704 -768 2384 -768
WIRE 2848 -768 2800 -768
WIRE 2912 -768 2848 -768
WIRE 3072 -768 2992 -768
WIRE 3440 -768 3072 -768
WIRE 4096 -768 3440 -768
WIRE 384 -736 384 -768
WIRE 528 -736 528 -768
WIRE -304 -688 -768 -688
WIRE 4096 -688 4096 -768
WIRE 2272 -640 2224 -640
WIRE 2320 -640 2272 -640
WIRE 3072 -640 3072 -768
WIRE 384 -624 384 -656
WIRE 528 -624 528 -656
WIRE -304 -608 -304 -688
WIRE -240 -608 -304 -608
WIRE -32 -608 -32 -768
WIRE -32 -608 -112 -608
WIRE 2752 -608 2752 -704
WIRE 2848 -608 2848 -768
WIRE -400 -560 -400 -768
WIRE -240 -560 -400 -560
WIRE 144 -560 -112 -560
WIRE 2160 -560 2160 -592
WIRE 2272 -560 2272 -640
WIRE 2272 -560 2160 -560
WIRE 3440 -560 3440 -768
WIRE 2384 -528 2384 -592
WIRE 2496 -528 2384 -528
WIRE 2576 -528 2496 -528
WIRE 2800 -528 2800 -544
WIRE 2800 -528 2576 -528
WIRE 384 -512 384 -560
WIRE 528 -512 528 -560
WIRE 528 -512 384 -512
WIRE 2160 -480 2160 -560
WIRE 2384 -480 2384 -528
WIRE 4096 -480 4096 -608
WIRE -176 -464 -176 -544
WIRE 1920 -432 1840 -432
WIRE 2096 -432 1920 -432
WIRE 3072 -432 3072 -560
WIRE 3072 -432 2448 -432
WIRE -272 -416 -368 -416
WIRE 1920 -416 1920 -432
WIRE 3072 -416 3072 -432
WIRE -1088 -400 -1184 -400
WIRE -1344 -384 -1632 -384
WIRE -1088 -368 -1184 -368
WIRE 2496 -368 2496 -528
WIRE -1344 -352 -1520 -352
WIRE 2160 -352 2160 -384
WIRE 2272 -352 2160 -352
WIRE 2384 -352 2384 -384
WIRE 2384 -352 2272 -352
WIRE -1088 -336 -1184 -336
WIRE -176 -320 -176 -384
WIRE 144 -320 144 -560
WIRE 3072 -320 3072 -336
WIRE 3280 -320 3072 -320
WIRE 528 -304 528 -512
WIRE 3072 -304 3072 -320
WIRE -128 -272 -208 -272
WIRE 16 -272 -64 -272
WIRE 1920 -272 1920 -352
WIRE -1520 -256 -1520 -352
WIRE -368 -240 -368 -416
WIRE 3376 -240 3328 -240
WIRE -368 -224 -368 -240
WIRE 2496 -208 2496 -304
WIRE 2528 -208 2496 -208
WIRE 3072 -208 3072 -224
WIRE 3072 -208 2528 -208
WIRE 3280 -208 3280 -224
WIRE 3280 -208 3072 -208
WIRE 3440 -208 3440 -480
WIRE 3440 -208 3280 -208
WIRE 4096 -208 4096 -416
WIRE 4096 -208 3440 -208
WIRE -208 -192 -208 -272
WIRE -192 -192 -208 -192
WIRE -80 -192 -128 -192
WIRE 16 -192 16 -272
WIRE 16 -192 0 -192
WIRE 608 -176 544 -176
WIRE 720 -176 672 -176
WIRE 864 -176 864 -768
WIRE 864 -176 800 -176
WIRE 2528 -176 2528 -208
WIRE -368 -128 -368 -144
WIRE -1632 -80 -1632 -384
WIRE -1520 -80 -1520 -176
WIRE 3200 -80 3200 -96
WIRE 16 -64 16 -192
WIRE 16 -64 -32 -64
WIRE 464 -64 16 -64
WIRE 544 -64 544 -176
WIRE 544 -64 464 -64
WIRE 656 -64 544 -64
WIRE 864 -64 864 -176
WIRE 864 -64 736 -64
WIRE 3104 -64 3104 -96
WIRE -368 -48 -368 -128
WIRE -208 -48 -208 -192
WIRE -208 -48 -368 -48
WIRE -96 -48 -208 -48
WIRE 32 -32 -32 -32
WIRE 464 -32 464 -64
WIRE 464 16 464 -32
WIRE 2960 16 2928 16
WIRE 3104 16 3040 16
WIRE 3136 16 3104 16
WIRE 3200 16 3200 0
WIRE 3200 16 3168 16
WIRE 3328 16 3200 16
WIRE 3456 16 3328 16
WIRE 3712 32 3696 32
WIRE 3904 32 3792 32
WIRE 4016 32 3904 32
WIRE 2928 48 2928 16
WIRE 3136 48 3136 16
WIRE 3168 48 3168 16
WIRE 3328 48 3328 16
WIRE 4128 48 4080 48
WIRE 4192 48 4128 48
WIRE 4400 48 4272 48
WIRE 4544 48 4400 48
WIRE -64 64 -64 -16
WIRE 3456 64 3456 16
WIRE 4016 64 3968 64
WIRE 4640 64 4608 64
WIRE 4688 64 4640 64
WIRE 3904 80 3904 32
WIRE 4544 80 4496 80
WIRE 464 112 464 96
WIRE 1840 128 1840 96
WIRE 3968 128 3968 64
WIRE 4128 128 4128 48
WIRE 4128 128 3968 128
WIRE 3152 160 3152 112
WIRE 3328 160 3328 128
WIRE 3328 160 3152 160
WIRE 3456 160 3456 128
WIRE 3456 160 3328 160
WIRE 32 176 32 -32
WIRE 112 176 32 176
WIRE 272 176 192 176
WIRE 2336 176 2336 32
WIRE 32 192 32 176
WIRE 3904 192 3904 160
WIRE 2912 208 2864 208
WIRE 2944 208 2912 208
WIRE 3152 208 3152 160
WIRE 3152 208 3024 208
WIRE 4496 208 4496 80
WIRE 4544 208 4496 208
WIRE 4640 208 4640 64
WIRE 4640 208 4624 208
WIRE 1840 224 1840 208
WIRE 1952 224 1840 224
WIRE 2464 224 2400 224
WIRE 2720 224 2544 224
WIRE 2800 224 2720 224
WIRE 1840 240 1840 224
WIRE 2064 240 2064 80
WIRE 2880 240 2864 240
WIRE 4496 256 4496 208
WIRE 1952 288 1952 224
WIRE 1952 288 1904 288
WIRE 2000 288 1952 288
WIRE 2880 304 2880 240
WIRE 2944 304 2880 304
WIRE 2336 320 2336 272
WIRE 32 336 32 256
WIRE 2720 352 2720 224
WIRE 2768 352 2720 352
WIRE 2880 352 2880 304
WIRE 2880 352 2848 352
WIRE 1840 368 1840 336
WIRE 2064 368 2064 336
WIRE 4496 368 4496 336
WIRE 2912 384 2912 208
WIRE 3696 416 3680 416
WIRE 3904 416 3776 416
WIRE 4032 416 3904 416
WIRE 4144 432 4096 432
WIRE 4192 432 4144 432
WIRE 4400 432 4400 48
WIRE 4400 432 4272 432
WIRE 3904 448 3904 416
WIRE 4032 448 4000 448
WIRE 2720 464 2720 352
WIRE 2768 464 2720 464
WIRE 2880 464 2880 352
WIRE 2880 464 2832 464
WIRE 1840 480 1840 448
WIRE 1952 480 1840 480
WIRE 2064 480 2064 448
WIRE 2064 480 1952 480
WIRE 2912 496 2912 464
WIRE 4000 496 4000 448
WIRE 4144 496 4144 432
WIRE 4144 496 4000 496
WIRE 1952 528 1952 480
WIRE 3904 560 3904 528
FLAG 1040 -768 VREG_2
FLAG 144 -320 0
FLAG 528 -304 0
FLAG -32 -768 Vsw
FLAG 464 112 0
FLAG -64 64 0
FLAG -176 -320 0
FLAG -272 -416 ctrl
IOPIN -272 -416 Out
FLAG -368 -240 x
FLAG -368 -128 y
FLAG 464 -32 Vf_buck
FLAG -64 -80 VOP
FLAG 32 336 0
FLAG 2528 -176 0
FLAG 3440 -768 Vo
FLAG 3072 -432 Vf
FLAG 2848 -768 Vs1
FLAG 2912 496 0
FLAG 2576 -528 Vod
FLAG 3024 304 Vrefc
FLAG 2928 48 0
FLAG 4496 368 0
FLAG 3904 560 0
FLAG 3904 192 0
FLAG 3376 -240 VPOSA
FLAG 4688 64 Vrefc
FLAG 3152 208 Vs
FLAG 2336 320 0
FLAG 2272 -352 Pol
FLAG 2064 80 Pol
FLAG 1952 528 0
FLAG 3104 -96 Vs1
FLAG 3200 -96 Vo
FLAG 2336 32 Vod
FLAG 3680 416 Vf
FLAG 4576 32 0
FLAG 4048 16 0
FLAG 4064 400 0
FLAG 2832 192 0
FLAG 3120 80 0
FLAG 1920 -272 0
FLAG 1888 -768 VREG_2
FLAG -1520 -80 0
FLAG -1632 -80 0
FLAG -1088 -400 VOP
FLAG -1088 -368 VPOSA
FLAG -1088 -336 VREF
FLAG -1520 -352 VIN
FLAG -768 -688 VIN
FLAG 272 176 VREF
FLAG 1840 96 VPOSA
FLAG 1760 -432 VREF
FLAG 2832 256 VOP
FLAG 3184 80 VOP
FLAG 4048 80 VOP
FLAG 4064 464 VOP
FLAG 4576 96 VOP
FLAG 3696 32 VREF
DATAFLAG 3312 -768 ""
SYMBOL ind 112 -752 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 90µ
SYMBOL cap 368 -624 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL cap 512 -624 R0
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 368 -752 R0
SYMATTR InstName R1
SYMATTR Value 100m
SYMBOL res 512 -752 R0
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 752 -80 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rf1
SYMATTR Value 46.2k
SYMBOL res 448 0 R0
SYMATTR InstName Rf2
SYMATTR Value 10.7k
SYMBOL bv -176 -480 R0
SYMATTR InstName B1
SYMATTR Value V=limit(v(ctrl), 0.01, 0.9)
SYMBOL voltage -368 -240 R0
WINDOW 0 41 45 Left 2
WINDOW 123 37 65 Left 2
WINDOW 39 41 73 Left 2
SYMATTR InstName Vz1
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser=0.1
SYMATTR Value ""
SYMBOL Opamps\\opamp2 -64 -112 M0
SYMATTR InstName U1
SYMATTR Value LM358
SYMBOL cap -64 -288 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 160p
SYMBOL cap -128 -208 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 3n
SYMBOL res 16 -208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL cap 672 -192 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 628p
SYMBOL res 816 -192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1.6k
SYMBOL ccm1 -176 -576 R0
SYMATTR InstName U2
SYMATTR Value CCM2
SYMATTR SpiceLine Ron=0.16
SYMATTR SpiceLine2 VD=0 RD=0.16
SYMBOL res 96 160 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R28
SYMATTR Value 10
SYMBOL cap 48 192 M0
SYMATTR InstName C6
SYMATTR Value 4.7µ
SYMBOL pnp 2224 -592 R180
WINDOW 3 84 4 Left 2
SYMATTR Value BC327-25
SYMATTR InstName Q1
SYMBOL pnp 2320 -592 M180
WINDOW 3 84 4 Left 2
SYMATTR Value BC327-25
SYMATTR InstName Q2
SYMBOL npn 2096 -480 R0
WINDOW 3 56 60 Left 2
SYMATTR Value BC546B
SYMATTR InstName Q3
SYMBOL npn 2448 -480 M0
WINDOW 3 56 60 Left 2
SYMATTR Value BC546B
SYMATTR InstName Q4
SYMBOL pnp 2800 -704 M270
WINDOW 3 84 4 Left 2
SYMATTR Value TIP42C
SYMATTR InstName TIP1
SYMBOL npn 2752 -544 R270
WINDOW 3 65 14 Left 2
WINDOW 0 64 36 Left 2
SYMATTR Value Q2N6487
SYMATTR InstName Q5
SYMBOL res 3056 -656 R0
WINDOW 3 36 68 Left 2
SYMATTR Value 3.16k
SYMATTR InstName Rf3
SYMBOL res 3056 -320 R0
WINDOW 3 36 68 Left 2
SYMATTR Value 840
SYMATTR InstName Rf4
SYMBOL res 3424 -576 R0
SYMATTR InstName RL1
SYMATTR Value {RL}
SYMBOL res 2144 -784 R0
WINDOW 3 36 68 Left 2
SYMATTR Value {RE}
SYMATTR InstName R5
SYMBOL res 2368 -784 R0
WINDOW 3 36 68 Left 2
SYMATTR Value {RE}
SYMATTR InstName R6
SYMBOL cap 4080 -480 R0
SYMATTR InstName C7
SYMATTR Value {CL}
SYMBOL res 3008 -784 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rs1
SYMATTR Value 0.1
SYMBOL res 3040 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R7
SYMATTR Value 1k
SYMBOL res 3040 288 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R8
SYMATTR Value 1k
SYMBOL res 2864 336 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R9
SYMATTR Value 100k
SYMBOL res 2896 368 R0
SYMATTR InstName R10
SYMATTR Value 100k
SYMBOL npn 2400 176 M0
SYMATTR InstName Q6
SYMATTR Value 2N2222
SYMBOL res 3312 32 R0
SYMATTR InstName R11
SYMATTR Value 100k
SYMBOL res 3184 -96 R0
SYMATTR InstName R12
SYMATTR Value 10k
SYMBOL res 3120 -80 M0
SYMATTR InstName R13
SYMATTR Value 10k
SYMBOL res 3056 0 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R14
SYMATTR Value 100k
SYMBOL res 3808 16 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R15
SYMATTR Value 50k
SYMBOL res 3920 176 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R16
SYMATTR Value 10k
SYMBOL res 3680 432 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R17
SYMATTR Value 54.4k
SYMBOL res 3888 432 R0
SYMATTR InstName R18
SYMATTR Value 46k
SYMBOL res 4288 32 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R19
SYMATTR Value 10k
SYMBOL res 4288 416 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R20
SYMATTR Value 10k
SYMBOL res 4640 192 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R21
SYMATTR Value 10k
SYMBOL res 4512 352 R180
WINDOW 0 36 76 Left 2
WINDOW 3 36 40 Left 2
SYMATTR InstName R22
SYMATTR Value 10k
SYMBOL res 3056 -432 R0
WINDOW 3 36 68 Left 2
SYMATTR Value 1K
SYMATTR InstName Rf5
SYMBOL nmos 3328 -320 M0
SYMATTR InstName M1
SYMBOL res 2560 208 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R23
SYMATTR Value 100
SYMBOL npn 1904 240 M0
SYMATTR InstName Q7
SYMATTR Value BC546B
SYMBOL res 1824 112 R0
SYMATTR InstName R24
SYMATTR Value 3.8K
SYMBOL npn 2000 240 R0
SYMATTR InstName Q8
SYMATTR Value BC546B
SYMBOL cap 2480 -368 R0
SYMATTR InstName C8
SYMATTR Value 100n
SYMBOL Opamps\\opamp2 4576 128 M180
SYMATTR InstName U3
SYMATTR Value LM358
SYMBOL Opamps\\opamp2 4048 112 M180
SYMATTR InstName U4
SYMATTR Value LM358
SYMBOL Opamps\\opamp2 4064 496 M180
SYMATTR InstName U5
SYMATTR Value LM358
SYMBOL Opamps\\opamp2 2832 288 R180
SYMATTR InstName U6
SYMATTR Value LM358
SYMBOL Opamps\\opamp2 3216 80 R90
SYMATTR InstName U7
SYMATTR Value LM358
SYMBOL res 4080 -704 R0
SYMATTR InstName R25
SYMATTR Value 1
SYMBOL res 1824 352 R0
SYMATTR InstName R26
SYMATTR Value 470
SYMBOL res 2048 352 R0
SYMATTR InstName R27
SYMATTR Value 470
SYMBOL cap 2832 448 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C9
SYMATTR Value 100n
SYMBOL cap 3440 64 R0
SYMATTR InstName C10
SYMATTR Value 100n
SYMBOL res 1856 -448 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R31
SYMATTR Value 10
SYMBOL cap 1904 -416 R0
SYMATTR InstName C11
SYMATTR Value 4.7µ
SYMBOL support -1264 -368 R0
SYMATTR InstName Support
SYMBOL voltage -1520 -272 R0
WINDOW 123 0 0 Left 0
WINDOW 39 24 44 Left 2
SYMATTR InstName V4
SYMATTR Value 12
SYMATTR SpiceLine Rser=0.1
TEXT 2448 0 Left 2 ;Lazo de Corriente
TEXT 3656 -56 Left 2 ;Referencia Lazo de Corriente
TEXT 4536 -48 Left 2 ;Sumador
TEXT 1760 -16 Left 2 ;Fuente de corriente de polarizacion\nEspejo Simple
TEXT 1816 -1392 Left 2 !.include LM358.txt
TEXT 1808 -1224 Left 2 !.MODEL TIP42C PNP(Is=66.19f Xti=3 Eg=1.11 Vaf=100 Bf=137.6 Ise=862.2f Ne=1.481 Ikf=1.642 Nk=.5695 Xtb=2 Br=5.88 Isc=273.5f Nc=1.24 Ikr=3.555 Rc=79.39m Cjc=870.4p Mjc=.6481 Vjc=.75 Fc=.5 Cje=390.1p Mje=.4343 Vje=.75 Tr=235.4n Tf=23.21n Itf=71.33 Xtf=5.982 Vtf=10 Rb=.1 Vceo=100 Icrating=6 mfg=Texas)
TEXT 896 -976 Left 2 !.tran 0 3m 0 startup uic
TEXT -1376 -640 Left 2 !.lib switching_average\\average.lib
TEXT 1304 -1048 Left 2 !.param CL 7u
TEXT 1312 -992 Left 2 !.param RL 250
TEXT 1320 -944 Left 2 !.param RE 470
TEXT 1792 -1120 Left 2 !.model SW SW (Ron = 0.1 Roff = 100Meg Vt=0.5 Vh=0.25 )
TEXT 1800 -1016 Left 2 !.include 2N6487.lib
