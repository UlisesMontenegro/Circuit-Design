Version 4
SHEET 1 1244 1120
WIRE 160 -64 -208 -64
WIRE 320 -64 160 -64
WIRE 576 -64 400 -64
WIRE 720 -64 576 -64
WIRE 1056 -64 720 -64
WIRE 1120 -64 1056 -64
WIRE 576 -32 576 -64
WIRE 720 -32 720 -64
WIRE -112 16 -576 16
WIRE 576 80 576 48
WIRE 720 80 720 48
WIRE -112 96 -112 16
WIRE -48 96 -112 96
WIRE 160 96 160 -64
WIRE 160 96 80 96
WIRE -208 144 -208 -64
WIRE -48 144 -208 144
WIRE 336 144 80 144
WIRE 576 192 576 144
WIRE 720 192 720 144
WIRE 720 192 576 192
WIRE 16 240 16 160
WIRE -80 288 -176 288
WIRE 16 384 16 320
WIRE 336 384 336 144
WIRE 720 400 720 192
WIRE 64 432 -16 432
WIRE 208 432 128 432
WIRE -176 464 -176 288
WIRE -176 480 -176 464
WIRE -16 512 -16 432
WIRE 0 512 -16 512
WIRE 112 512 64 512
WIRE 208 512 208 432
WIRE 208 512 192 512
WIRE 800 528 736 528
WIRE 912 528 864 528
WIRE 1056 528 1056 -64
WIRE 1056 528 992 528
WIRE -176 576 -176 560
WIRE 208 640 208 512
WIRE 208 640 160 640
WIRE 656 640 208 640
WIRE 736 640 736 528
WIRE 736 640 656 640
WIRE 848 640 736 640
WIRE 1056 640 1056 528
WIRE 1056 640 928 640
WIRE -176 656 -176 576
WIRE -16 656 -16 512
WIRE -16 656 -176 656
WIRE 96 656 -16 656
WIRE 224 672 160 672
WIRE 656 672 656 640
WIRE 656 720 656 672
WIRE 128 768 128 688
WIRE 656 816 656 800
WIRE 224 880 224 672
WIRE 304 880 224 880
WIRE 464 880 384 880
WIRE 224 896 224 880
WIRE 224 1024 224 960
WIRE 224 1024 16 1024
WIRE 224 1040 224 1024
FLAG 336 384 0
FLAG 720 400 0
FLAG 160 -64 Vsw
FLAG 656 816 0
FLAG 128 768 0
FLAG 16 384 0
FLAG -80 288 ctrl
IOPIN -80 288 Out
FLAG -176 464 x
FLAG -176 576 y
FLAG 656 672 Vf_buck
FLAG 224 1040 0
FLAG -576 16 VIN
IOPIN -576 16 In
FLAG 464 880 VREF
IOPIN 464 880 In
FLAG 128 624 VOP
IOPIN 128 624 In
FLAG 1120 -64 VREG
IOPIN 1120 -64 Out
FLAG 16 1024 GND
IOPIN 16 1024 In
SYMBOL ind 304 -48 R270
WINDOW 0 32 56 VTop 2
WINDOW 3 5 56 VBottom 2
SYMATTR InstName L1
SYMATTR Value 90µ
SYMBOL cap 560 80 R0
SYMATTR InstName C1
SYMATTR Value 10µ
SYMBOL cap 704 80 R0
SYMATTR InstName C2
SYMATTR Value 1n
SYMBOL res 560 -48 R0
SYMATTR InstName R1
SYMATTR Value 100m
SYMBOL res 704 -48 R0
SYMATTR InstName R2
SYMATTR Value 0.1
SYMBOL res 944 624 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rf1
SYMATTR Value 46.2k
SYMBOL res 640 704 R0
SYMATTR InstName Rf2
SYMATTR Value 10.7k
SYMBOL bv 16 224 R0
SYMATTR InstName B1
SYMATTR Value V=limit(v(ctrl), 0.01, 0.9)
SYMBOL voltage -176 464 R0
WINDOW 0 41 45 Left 2
WINDOW 123 37 65 Left 2
WINDOW 39 41 73 Left 2
SYMATTR InstName Vz1
SYMATTR Value2 AC 1
SYMATTR SpiceLine Rser=0.1
SYMATTR Value ""
SYMBOL Opamps\\opamp2 128 592 M0
SYMATTR InstName U1
SYMATTR Value LM358
SYMBOL cap 128 416 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C3
SYMATTR Value 160p
SYMBOL cap 64 496 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C4
SYMATTR Value 3n
SYMBOL res 208 496 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R3
SYMATTR Value 10k
SYMBOL cap 864 512 R90
WINDOW 0 0 32 VBottom 2
WINDOW 3 32 32 VTop 2
SYMATTR InstName C5
SYMATTR Value 628p
SYMBOL res 1008 512 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R4
SYMATTR Value 1.6k
SYMBOL res 288 864 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName R5
SYMATTR Value 10
SYMBOL cap 240 896 M0
SYMATTR InstName C6
SYMATTR Value 4.7µ
SYMBOL ccm1 16 128 R0
SYMATTR InstName U3
SYMATTR Value CCM2
SYMATTR SpiceLine Ron=0.16
SYMATTR SpiceLine2 VD=0 RD=0.16
TEXT -680 1104 Left 2 !.tran 100m startup
TEXT -664 1056 Left 2 !.include LM358.txt
TEXT -712 1016 Left 2 !.lib switching_average\\average.lib
